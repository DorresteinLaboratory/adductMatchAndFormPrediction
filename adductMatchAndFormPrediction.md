

```R
library(Rdisop)
source("code/matchIonizationMode.R")
source("code/get_form.R")
source("code/split_and_filter.R")
```


```R
# import atom exact mass to adduct calculation
adduct_n <- read.csv("ESI-MS-adducts-calculator-Vsept2012_neg.csv")
adduct_p <- read.csv("ESI-MS-adducts-calculator-Vsept2012_pos.csv")
head(adduct_n)
head(adduct_p)
```


<table>
<thead><tr><th scope=col>Ion.name</th><th scope=col>Ion.mass</th><th scope=col>Charge</th><th scope=col>Mult</th><th scope=col>Mass</th></tr></thead>
<tbody>
	<tr><td>M-3H           </td><td>M/3 - 1.007276 </td><td>3-             </td><td>0.3333333      </td><td> -1.007276     </td></tr>
	<tr><td>M-2H           </td><td>M/2 - 1.007276 </td><td>2-             </td><td>0.5000000      </td><td> -1.007276     </td></tr>
	<tr><td>M-H2O-H        </td><td>M- 19.01839    </td><td>1-             </td><td>1.0000000      </td><td>-19.018390     </td></tr>
	<tr><td>M-H            </td><td>M - 1.007276   </td><td>1-             </td><td>1.0000000      </td><td> -1.007276     </td></tr>
	<tr><td>M+Na-2H        </td><td>M + 20.974666  </td><td>1-             </td><td>1.0000000      </td><td> 20.974666     </td></tr>
	<tr><td>M+Cl           </td><td>M + 34.969402  </td><td>1-             </td><td>1.0000000      </td><td> 34.969402     </td></tr>
</tbody>
</table>




<table>
<thead><tr><th scope=col>Ion.name</th><th scope=col>Ion.mass</th><th scope=col>Charge</th><th scope=col>Mult</th><th scope=col>Mass</th></tr></thead>
<tbody>
	<tr><td>M+3H             </td><td>M/3 + 1.007276   </td><td>3+               </td><td>0.33             </td><td> 1.007276        </td></tr>
	<tr><td>M+2H+Na          </td><td>M/3 + 8.334590   </td><td>3+               </td><td>0.33             </td><td> 8.334590        </td></tr>
	<tr><td>M+H+2Na          </td><td>M/3 + 15.7661904 </td><td>3+               </td><td>0.33             </td><td>15.766190        </td></tr>
	<tr><td>M+3Na            </td><td>M/3 + 22.989218  </td><td>3+               </td><td>0.33             </td><td>22.989218        </td></tr>
	<tr><td>M+2H             </td><td>M/2 + 1.007276   </td><td>2+               </td><td>0.50             </td><td> 1.007276        </td></tr>
	<tr><td>M+H+NH4          </td><td>M/2 + 9.520550   </td><td>2+               </td><td>0.50             </td><td> 9.520550        </td></tr>
</tbody>
</table>




```R
# assign masses to the adducts of interest
na <- 22.989218
h <- 1.007276
cl <- 34.969402
```


```R
# Load the feature tables from positive and negative mode
# exclude the line with the *60 if the retention time is already
# in seconds
pos <- read.csv("TEST1/161205_Positive_filtered_shared_features.csv")
pos <- pos[, c("row.m.z", "row.retention.time")]
pos[,2] <- pos[,2]*60

neg <- read.csv("TEST1/12042016_filtered_Negative2.csv")
neg <- neg[, c("row.m.z", "row.retention.time")]
neg[,2] <- neg[,2]*60
```


```R
# adductdiff = 2 * h = 2.014552 and  mz.abs.tol (+/- 0.005) accounts for absolute m/z error
# rt.abs.tol=20 is the allowed retention time drift between aquisition modes
negx <- matchIonizationMode(neg[,c("row.m.z", "row.retention.time")], pos[,c("row.m.z", "row.retention.time")], adductdiff=2.014552, mz.abs.tol=0.005, rt.abs.tol=20)
```


```R
# adductdiff = na + h = 23.99649 and  mz.abs.tol (+/- 0.01) accounts for absolute m/z error
# rt.abs.tol=20 is the allowed retention time drift between aquisition modes
negxNa <- matchIonizationMode(neg[,c("row.m.z", "row.retention.time")], pos[,c("row.m.z", "row.retention.time")], adductdiff=23.99649, mz.abs.tol=0.01, rt.abs.tol=20)
```


```R
# adductdiff = -(cl - h) = -33.96213, here the difference has to be negative, because the mass of 
# [M+Cl] > [M+H]
# mz.abs.tol (+/- 0.01) accounts for absolute m/z error
# rt.abs.tol=20 is the allowed retention time drift between aquisition modes
negxCl <- matchIonizationMode(neg[,c("row.m.z", "row.retention.time")], pos[,c("row.m.z", "row.retention.time")], adductdiff=-33.96213, mz.abs.tol=0.01, rt.abs.tol=20)
```


```R
# Compile the tables and generate a table with only ions matching positive and negative mode
allneg <- cbind(negx, negxNa[,-c(1,2)])
allneg <- cbind(allneg, negxCl[,-c(1,2)])
colnames(allneg)[3:8] <- c( "mass_on_pos_tableH", "rt_on_pos_tableH", "mass_on_pos_tableNa", "rt_on_pos_tableNa", "mass_on_pos_tableCl", "rt_on_pos_tableCl")
ex <- apply(allneg, 1, function(x) sum(x[3:8]=="")==6)
allnegs <- allneg[!ex,]
```


```R
dim(neg)
```


<ol class=list-inline>
	<li>8546</li>
	<li>2</li>
</ol>




```R
head(allnegs)
```


<table>
<thead><tr><th></th><th scope=col>row.m.z</th><th scope=col>row.retention.time</th><th scope=col>mass_on_pos_tableH</th><th scope=col>rt_on_pos_tableH</th><th scope=col>mass_on_pos_tableNa</th><th scope=col>rt_on_pos_tableNa</th><th scope=col>mass_on_pos_tableCl</th><th scope=col>rt_on_pos_tableCl</th></tr></thead>
<tbody>
	<tr><th scope=row>3</th><td>265.1478               </td><td>604.9176               </td><td>267.1593434;267.1591933</td><td>607.786818;592.86199998</td><td>289.1538153;289.141276 </td><td>613.5690486;600.0843336</td><td>                       </td><td>                       </td></tr>
	<tr><th scope=row>4</th><td>331.2491               </td><td>535.4694               </td><td>333.2637768            </td><td>535.2827625            </td><td>355.246215             </td><td>535.27910256           </td><td>                       </td><td>                       </td></tr>
	<tr><th scope=row>7</th><td>299.2591               </td><td>641.8074               </td><td>                       </td><td>                       </td><td>323.2580719;323.2580414</td><td>659.7529998;623.3655   </td><td>                       </td><td>                       </td></tr>
	<tr><th scope=row>8</th><td>221.1546               </td><td>617.2219               </td><td>223.1697655            </td><td>617.3025               </td><td>                       </td><td>                       </td><td>                       </td><td>                       </td></tr>
	<tr><th scope=row>10</th><td>233.1546               </td><td>618.5047               </td><td>235.1695874;235.1696329</td><td>618.321198;605.569875  </td><td>                       </td><td>                       </td><td>                       </td><td>                       </td></tr>
	<tr><th scope=row>11</th><td>297.1528               </td><td>606.4535               </td><td>299.1648356            </td><td>605.8429998            </td><td>                       </td><td>                       </td><td>263.1980866            </td><td>623.9719554            </td></tr>
</tbody>
</table>




```R
flist <- list()
flags <- c()
for(i in 1:nrow(allnegs)) {
#for(i in 1:5) {        
        posh <- c()
        negh <- c()
        negcl <- c()
        posna <- c()

        if(sum(allnegs[i, c(3,5)]=="")==2 & allnegs[i, 7]!="") {
                negcl <- get_form(as.numeric(strsplit(as.character(allnegs[i,1]), ";")[[1]])[1]-34.969402)
        } else {
                negh <- get_form(as.numeric(allnegs[i, 1])+1.007276)
                if(allnegs[1, 7]!="") {
                        negcl <- get_form(as.numeric(strsplit(as.character(allnegs[i,1]), ";")[[1]])[1]-34.969402)
                }
        }

        if(allnegs[i, "mass_on_pos_tableH"]!="") {
                posh <- get_form(as.numeric(strsplit(as.character(allnegs[i, "mass_on_pos_tableH"]), ";")[[1]])[1]-1.007276)
        }
        if(allnegs[i, "mass_on_pos_tableNa"]!="") {
                posna <- get_form(as.numeric(strsplit(as.character(allnegs[i, "mass_on_pos_tableNa"]), ";")[[1]])[1]-22.989218)
        }
        flag <- ""

        if(length(negh)>0 | length(negcl)>0 ) {
                if(length(negh)==0 | length(negcl)>0 ) {
                        negh <- negcl
                        flag <- "+cl"
                } else {
                        flag <- "-h"
                }

                if(length(posh)>0 & sum(negh[,1] %in% posh[,1]) ) {
                        negh <- matrix(negh[negh[,1] %in% posh[,1], ], ncol=2)
                        flag <- paste0(flag, "+h")
                }

                if(length(posna)>0 & sum(negh[,1] %in% posna[,1]) ) {
                        negh <- matrix(negh[negh[,1] %in% posna[,1], ], ncol=2)
                        flag <- paste0(flag, "+na")
                }

                if(length(negcl)>0 & sum(negh[,1] %in% negcl[,1]) ) {
                        negh <- matrix(negh[negh[,1] %in% negcl[,1], ], ncol=2)
                        flag <- paste0(flag, "+cl")
                }
        }
        flist[[i]] <- negh
        flags <- c(flags, flag)
}


```


```R
# Format the table to keep the 10 first can. It can allow more changing the number 10 below
# Remember that this formulas were generated with ppm=5/without P 
for(i in 1:length(flist)) if(!is.null(flist[[i]])) { if(nrow(flist[[i]])>10) flist[[i]] <- flist[[i]][1:10,] } else { flist[[i]] <- matrix("", ncol=2) }

fms <- lapply(flist, function(x) paste(x[,1], collapse=";"))
sc <- lapply(flist, function(x) paste(x[,2], collapse=";"))
allnegs <- data.frame(allnegs, Formulas=unlist(fms), Scores=unlist(sc), Flag=flags)
```


```R
allnegs
```


<table>
<thead><tr><th></th><th scope=col>row.m.z</th><th scope=col>row.retention.time</th><th scope=col>mass_on_pos_tableH</th><th scope=col>rt_on_pos_tableH</th><th scope=col>mass_on_pos_tableNa</th><th scope=col>rt_on_pos_tableNa</th><th scope=col>mass_on_pos_tableCl</th><th scope=col>rt_on_pos_tableCl</th><th scope=col>Formulas</th><th scope=col>Scores</th><th scope=col>Flag</th></tr></thead>
<tbody>
	<tr><th scope=row>3</th><td>265.1478                                                                                                                                                                                                   </td><td>604.9176                                                                                                                                                                                                   </td><td>267.1593434;267.1591933                                                                                                                                                                                    </td><td>607.786818;592.86199998                                                                                                                                                                                    </td><td>289.1538153;289.141276                                                                                                                                                                                     </td><td>613.5690486;600.0843336                                                                                                                                                                                    </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>C12H26O4S;C4H22N6O7;C5H34N2OS4;C4H30N2O6S2;C5H147N3O;C5H26N6O2S2;C5H18N10O3;C3H26N2O11;CH14N16O                                                                                                            </td><td>0.291728046899418;0.265637906597544;0.115116666366116;0.0178988621545199;0.00680963298497408;0.00319911620256948;8.32079874865639e-06;2.59788454699252e-07;2.14836997744768e-07                            </td><td>-h                                                                                                                                                                                                         </td></tr>
	<tr><th scope=row>4</th><td>331.2491                                                                                                                                                                                                   </td><td>535.4694                                                                                                                                                                                                   </td><td>333.2637768                                                                                                                                                                                                </td><td>535.2827625                                                                                                                                                                                                </td><td>355.246215                                                                                                                                                                                                 </td><td>535.27910256                                                                                                                                                                                               </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>C3H40N8O5S2;C18H36O5;C11H44N2O2S3;C4H157N9;C3H32N12O6;C3H48N4O4S4;C11H36N6O3S;C10H40N2O7S;C19H40S2;C4H44N8S4                                                                                               </td><td>0.113609629123458;0.103916652331871;0.103796778991732;0.0825482311231669;0.0375946782120292;0.0182239611311646;0.0151462362298204;0.00492264716599492;0.00490877721265675;0.00389623355815448              </td><td>-h+h+na                                                                                                                                                                                                    </td></tr>
	<tr><th scope=row>7</th><td>299.2591                                                                                                                                                                                                   </td><td>641.8074                                                                                                                                                                                                   </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>323.2580719;323.2580414                                                                                                                                                                                    </td><td>659.7529998;623.3655                                                                                                                                                                                       </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>H173NOS3                                                                                                                                                                                                   </td><td>5.91018600546938e-07                                                                                                                                                                                       </td><td>-h+na                                                                                                                                                                                                      </td></tr>
	<tr><th scope=row>8</th><td>221.1546                                                                                                                                                                                                   </td><td>617.2219                                                                                                                                                                                                   </td><td>223.1697655                                                                                                                                                                                                </td><td>617.3025                                                                                                                                                                                                   </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>C14H22O2;C6H26N2O4S;C7H22N6S                                                                                                                                                                               </td><td>0.309136101869248;0.0119242665122486;0.000503735287817614                                                                                                                                                  </td><td>-h+h                                                                                                                                                                                                       </td></tr>
	<tr><th scope=row>10</th><td>233.1546                                                                                                                                                                                                   </td><td>618.5047                                                                                                                                                                                                   </td><td>235.1695874;235.1696329                                                                                                                                                                                    </td><td>618.321198;605.569875                                                                                                                                                                                      </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>C15H22O2;H26N8O2S2;H34N4OS4;C7H26N2O4S;H18N12O3;H42S6;C8H22N6S                                                                                                                                             </td><td>0.220536182010116;0.188597561587354;0.0829253590813214;0.0146950878027628;0.00487032952530153;0.000874469717409341;0.000521971565053549                                                                    </td><td>-h+h                                                                                                                                                                                                       </td></tr>
	<tr><th scope=row>11</th><td>297.1528                                                                                                                                                                                                   </td><td>606.4535                                                                                                                                                                                                   </td><td>299.1648356                                                                                                                                                                                                </td><td>605.8429998                                                                                                                                                                                                </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>263.1980866                                                                                                                                                                                                </td><td>623.9719554                                                                                                                                                                                                </td><td>H34N4O7S3;CH151N5O2S;C7H26N2O10;C5H14N16                                                                                                                                                                   </td><td>7.162113892749e-05;1.8554956048685e-05;4.69206995154508e-06;4.0566511133493e-06                                                                                                                            </td><td>-h+h                                                                                                                                                                                                       </td></tr>
	<tr><th scope=row>12</th><td>242.1762                                                                                                                                                                                                   </td><td>445.2437                                                                                                                                                                                                   </td><td>244.1909996                                                                                                                                                                                                </td><td>445.07591142                                                                                                                                                                                               </td><td>266.1727686                                                                                                                                                                                                </td><td>445.04526084                                                                                                                                                                                               </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>C13H25NO3;C6H33N3S3;C6H25N7OS;C5H29N3O5S;C2H154O4                                                                                                                                                          </td><td>0.390273094575672;0.291457751717015;0.0104115640571638;0.00318771488247309;3.22655646480777e-06                                                                                                            </td><td>-h+h+na                                                                                                                                                                                                    </td></tr>
	<tr><th scope=row>13</th><td>309.1742                                                                                                                                                                                                   </td><td>638.6725                                                                                                                                                                                                   </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>275.2036816;275.2217331;275.2214966                                                                                                                                                                        </td><td>628.247238;650.9835;635.9290002                                                                                                                                                                            </td><td>C2H22N14O2;C4H34O12;C2H30N10OS2;C17H26N2O;C2H38N6S4;C9H30N4O3S;C6H155NO2;C5H38O7S2;CH26N10O6;C9H38O2S3                                                                                                     </td><td>0.167360230747657;0.159885607320987;0.122764683725015;0.103917178730147;0.0045790787339567;0.000479907506648241;0.000409650450851879;0.000104430060202324;4.87901991412277e-05;6.71886726877468e-07        </td><td>+cl+cl                                                                                                                                                                                                     </td></tr>
	<tr><th scope=row>14</th><td>293.1759                                                                                                                                                                                                   </td><td>577.6112                                                                                                                                                                                                   </td><td>295.1902665;295.189859;295.189785                                                                                                                                                                          </td><td>577.29411762;558.82639998;591.02575002                                                                                                                                                                     </td><td>317.1752319;317.1743774                                                                                                                                                                                    </td><td>569.90266668;587.52466668                                                                                                                                                                                  </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>C18H22N4;C3H26N12S2                                                                                                                                                                                        </td><td>3.37295532309679e-05;2.2047299460728e-05                                                                                                                                                                   </td><td>-h+h+na                                                                                                                                                                                                    </td></tr>
	<tr><th scope=row>15</th><td>293.1760                                                                                                                                                                                                   </td><td>545.5763                                                                                                                                                                                                   </td><td>295.189859;295.1903168                                                                                                                                                                                     </td><td>558.82639998;532.65379998                                                                                                                                                                                  </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>C10H34N2OS3;C2H30N8O4S2;C17H26O4;C2H22N12O5;C10H26N6O2S;C2H38N4O3S4;C9H30N2O6S;CH26N8O9;C2H46O2S6;CH34N4O8S2                                                                                               </td><td>0.191455990714109;0.158941186553322;0.141826512197692;0.0631331390885773;0.0223281531515091;0.0148943312825743;0.00270898187166745;0.000465204555454809;0.0002200861223127;1.26681270743918e-06            </td><td>-h+h                                                                                                                                                                                                       </td></tr>
	<tr><th scope=row>16</th><td>243.1601                                                                                                                                                                                                   </td><td>520.4327                                                                                                                                                                                                   </td><td>245.17491                                                                                                                                                                                                  </td><td>520.09699998                                                                                                                                                                                               </td><td>267.1593628;267.1569722;267.15942                                                                                                                                                                          </td><td>539.23219998;524.43533334;514.4745                                                                                                                                                                         </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>C13H24O4;C6H32N2OS3;C5H28N2O6S;C6H24N6O2S                                                                                                                                                                  </td><td>0.36749520480134;0.126572795146754;0.0164535342215305;0.00189597396595343                                                                                                                                  </td><td>-h+h                                                                                                                                                                                                       </td></tr>
	<tr><th scope=row>17</th><td>271.1915                                                                                                                                                                                                   </td><td>582.4374                                                                                                                                                                                                   </td><td>273.2060394                                                                                                                                                                                                </td><td>582.01549998                                                                                                                                                                                               </td><td>295.1902665;295.189785;295.1905243                                                                                                                                                                         </td><td>577.29411762;591.02575002;600.5896002                                                                                                                                                                      </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>C16H24N4;CH28N12S2                                                                                                                                                                                         </td><td>2.85014578684413e-06;1.69126290426534e-06                                                                                                                                                                  </td><td>-h+h+na                                                                                                                                                                                                    </td></tr>
	<tr><th scope=row>18</th><td>257.1759                                                                                                                                                                                                   </td><td>559.6350                                                                                                                                                                                                   </td><td>259.1907196;259.1904297                                                                                                                                                                                    </td><td>575.21800002;559.39971426                                                                                                                                                                                  </td><td>281.1744607;281.1749246                                                                                                                                                                                    </td><td>570.75836364;556.6987143                                                                                                                                                                                   </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>C15H22N4;H26N12S2                                                                                                                                                                                          </td><td>2.20188080139674e-06;1.24983991106314e-06                                                                                                                                                                  </td><td>-h+h+na                                                                                                                                                                                                    </td></tr>
	<tr><th scope=row>19</th><td>285.2072                                                                                                                                                                                                   </td><td>518.3619                                                                                                                                                                                                   </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>309.2033963                                                                                                                                                                                                </td><td>517.25944446                                                                                                                                                                                               </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>CH34N8O4S2;C16H30O4;C9H38N2OS3;CH26N12O5;CH42N4O3S4;C9H30N6O2S;C8H34N2O6S;H30N8O9;CH50O2S6;H38N4O8S2                                                                                                       </td><td>0.184490270785247;0.166161060524665;0.157462337115459;0.0439466567088976;0.0192525045371253;0.0135749755808639;0.00358723255405184;0.000618559056847699;0.000291875043531895;1.57944321130476e-06          </td><td>-h+na                                                                                                                                                                                                      </td></tr>
	<tr><th scope=row>24</th><td>285.2071                                                                                                                                                                                                   </td><td>599.2204                                                                                                                                                                                                   </td><td>287.2216237                                                                                                                                                                                                </td><td>599.205                                                                                                                                                                                                    </td><td>309.2059501;309.2060699;309.2060406                                                                                                                                                                        </td><td>617.1169428;602.5075002;591.82230768                                                                                                                                                                       </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>C17H26N4;C2H30N12S2                                                                                                                                                                                        </td><td>3.76912179923972e-06;2.31142134594249e-06                                                                                                                                                                  </td><td>-h+h+na                                                                                                                                                                                                    </td></tr>
	<tr><th scope=row>25</th><td>313.2385                                                                                                                                                                                                   </td><td>581.4515                                                                                                                                                                                                   </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>337.2349138                                                                                                                                                                                                </td><td>580.67322498                                                                                                                                                                                               </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>C3H38N8O4S2;C18H34O4;C11H42N2OS3;C3H30N12O5;C3H46N4O3S4;C11H34N6O2S;C10H38N2O6S;C2H34N8O9;C3H54O2S6;C19H30N4                                                                                               </td><td>0.179124194400404;0.163570500471558;0.142943055968597;0.0456377829312297;0.0263140801041381;0.0163680474028829;0.00646174023858844;0.00149633176177527;0.000801715895035855;5.39532681284467e-05           </td><td>-h+na                                                                                                                                                                                                      </td></tr>
	<tr><th scope=row>26</th><td>271.2278                                                                                                                                                                                                   </td><td>611.3241                                                                                                                                                                                                   </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>295.2265259;295.2264191;295.2265383;295.2264303                                                                                                                                                            </td><td>627.7194;619.4422002;599.99816664;605.8450002                                                                                                                                                              </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>C16H32O3;CH36N8O3S2;C9H40N2S3;CH44N4O2S4;CH28N12O4;C8H36N2O5S;C9H32N6OS;H32N8O8;CH52OS6;H40N4O7S2                                                                                                          </td><td>0.213777028551204;0.192968521164257;0.0941456610607334;0.0412872243632255;0.0168227713558083;0.00877907791603562;0.0036806144322976;0.00164510712069264;0.000795114678241663;4.52175636590771e-06          </td><td>-h                                                                                                                                                                                                         </td></tr>
	<tr><th scope=row>27</th><td>277.1444                                                                                                                                                                                                   </td><td>595.0884                                                                                                                                                                                                   </td><td>279.159165;279.1565573;279.1593689                                                                                                                                                                         </td><td>606.9973794;577.15693104;591.27679998                                                                                                                                                                      </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>C16H22O4;CH26N8O4S2;CH34N4O3S4;C9H30N2OS3;C8H26N2O6S;CH18N12O5;H22N8O9;CH42O2S6;C9H22N6O2S;H30N4O8S2                                                                                                       </td><td>0.182060335897966;0.160051613594909;0.0981258705689088;0.0672394178853164;0.02759814238266;0.00948340284607362;0.00672610959403154;0.0036130130216008;0.00179612642881566;3.98465883398526e-05             </td><td>-h+h                                                                                                                                                                                                       </td></tr>
	<tr><th scope=row>33</th><td>263.1652                                                                                                                                                                                                   </td><td>584.8324                                                                                                                                                                                                   </td><td>265.1801619;265.1800598;265.180027                                                                                                                                                                         </td><td>584.0872836;593.8455;568.73925                                                                                                                                                                             </td><td>287.1640472                                                                                                                                                                                                </td><td>573.38650002                                                                                                                                                                                               </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>C16H24O3;CH28N8O3S2;C9H32N2S3;CH36N4O2S4;CH20N12O4;C8H28N2O5S;C9H24N6OS;H24N8O8;CH44OS6                                                                                                                    </td><td>0.209553679217897;0.187331927932662;0.0855306758635417;0.0465052509418158;0.0131423031511914;0.00958933696657658;0.0025320013343196;0.00171233671702004;0.000808025845082671                               </td><td>-h+h                                                                                                                                                                                                       </td></tr>
	<tr><th scope=row>36</th><td>549.0164                                                                                                                                                                                                   </td><td>599.6883                                                                                                                                                                                                   </td><td>551.027242                                                                                                                                                                                                 </td><td>609.8323332                                                                                                                                                                                                </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>C28H14N4O3S3;CH151N7O8S5;C7H26N4O16S4;C2H268N8O3S3;C5H14N18O6S4;C17H264O3S;C20H10N10O6S2;C35H6N2O6;C8H143N5O11S2;C6H131N19OS2                                                                              </td><td>0.00173174421172422;0.00154714439014949;0.00106944331621287;0.00104470780598452;0.00102845920830464;0.00092279228067904;0.000908123645069232;0.000799677104524594;0.000701993736106131;0.000673135523482471</td><td>-h+h                                                                                                                                                                                                       </td></tr>
	<tr><th scope=row>41</th><td>215.1288                                                                                                                                                                                                   </td><td>427.4029                                                                                                                                                                                                   </td><td>217.1439501                                                                                                                                                                                                </td><td>426.63883332                                                                                                                                                                                               </td><td>239.1282568;239.1282142                                                                                                                                                                                    </td><td>419.32825002;434.07028572                                                                                                                                                                                  </td><td>181.1589308;181.158933                                                                                                                                                                                     </td><td>444.877125;407.97833334                                                                                                                                                                                    </td><td>C11H20O4;C4H28N2OS3;C3H24N2O6S;C4H20N6O2S                                                                                                                                                                  </td><td>0.753865749376428;0.197266630773806;0.0246912827603369;0.000907092998478873                                                                                                                                </td><td>-h+h                                                                                                                                                                                                       </td></tr>
	<tr><th scope=row>42</th><td>299.2227                                                                                                                                                                                                   </td><td>613.5738                                                                                                                                                                                                   </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>323.2213402                                                                                                                                                                                                </td><td>628.2132498                                                                                                                                                                                                </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>C2H28N12O5;C10H32N6O2S;C18H28N4;C3H32N12S2                                                                                                                                                                 </td><td>0.0154413454927456;0.00384727000320164;2.63425632277403e-06;1.63595055892929e-06                                                                                                                           </td><td>-h+na                                                                                                                                                                                                      </td></tr>
	<tr><th scope=row>46</th><td>311.1687                                                                                                                                                                                                   </td><td>633.4072                                                                                                                                                                                                   </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>277.2138352;277.2161987                                                                                                                                                                                    </td><td>637.2686622;617.772                                                                                                                                                                                        </td><td>C5H20N14;C7H32O10;CH157N3O2S;H40N2O7S3;C12H28N4OS;H32N6O8S;C9H153N;C4H24N10O4;C8H36O5S2;CH44N2O2S5                                                                                                         </td><td>0.189497723678067;0.180368029316097;0.105298543751677;0.0533419791352217;0.0011923078550809;0.000818278745636673;0.000356376266303243;0.000136349112060716;8.77679532936126e-05;3.98373857006591e-06       </td><td>+cl+cl                                                                                                                                                                                                     </td></tr>
	<tr><th scope=row>51</th><td>271.2279                                                                                                                                                                                                   </td><td>655.6806                                                                                                                                                                                                   </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>295.2265659;295.2264592;295.2263184                                                                                                                                                                        </td><td>636.8091114;655.0003074;643.5154998                                                                                                                                                                        </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>CH36N8O3S2;C16H32O3;C9H40N2S3;CH28N12O4;CH44N4O2S4;C9H32N6OS;C8H36N2O5S;H32N8O8;CH52OS6;H40N4O7S2                                                                                                          </td><td>0.215052838166161;0.19529695335953;0.123118794450695;0.026878075999078;0.0238025442447758;0.00675221592879881;0.00430469401242213;0.000699527152629212;0.000319965008722812;1.31680549549174e-06           </td><td>-h                                                                                                                                                                                                         </td></tr>
	<tr><th scope=row>54</th><td>253.1445                                                                                                                                                                                                   </td><td>509.3066                                                                                                                                                                                                   </td><td>255.1594198;255.1568666;255.1592763                                                                                                                                                                        </td><td>508.79663952;513.2040714;497.64633336                                                                                                                                                                      </td><td>277.1427841;277.1415666                                                                                                                                                                                    </td><td>516.4095;498.31170588                                                                                                                                                                                      </td><td>219.1876157                                                                                                                                                                                                </td><td>512.39766666                                                                                                                                                                                               </td><td>C7H22N6O2S;C15H18N4;H22N12S2                                                                                                                                                                               </td><td>0.00596977133914822;8.55326541440371e-07;4.70632407327385e-07                                                                                                                                              </td><td>-h+h+na                                                                                                                                                                                                    </td></tr>
	<tr><th scope=row>57</th><td>367.2463                                                                                                                                                                                                   </td><td>641.7301                                                                                                                                                                                                   </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>391.2461446;391.2461466                                                                                                                                                                                    </td><td>628.1606664;647.8743078                                                                                                                                                                                    </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>C6H56O3S6;C3H24N22;C5H36N8O10                                                                                                                                                                              </td><td>7.447268186411e-07;3.72156299756595e-07;3.27352054438665e-07                                                                                                                                               </td><td>-h+na                                                                                                                                                                                                      </td></tr>
	<tr><th scope=row>59</th><td>599.0134                                                                                                                                                                                                   </td><td>604.5809                                                                                                                                                                                                   </td><td>601.0293318                                                                                                                                                                                                </td><td>621.8419998                                                                                                                                                                                                </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>C32H16N4OS4;C2H121N29O3;C17H20N12OS6;C4H133N15O13;C6H145NO23;C5H153N7O6S6;C2H24N20OS8;C4H36N6O11S8;C16N20O8;C18H12N6O18                                                                                    </td><td>0.00989026990947944;0.00979923403086743;0.00969740661290955;0.00966918122517564;0.00953921586214028;0.00948110862307571;0.00928987966709944;0.00916036694486327;0.0088551177071357;0.00872648666752807     </td><td>-h+h                                                                                                                                                                                                       </td></tr>
	<tr><th scope=row>62</th><td>279.1635                                                                                                                                                                                                   </td><td>637.5343                                                                                                                                                                                                   </td><td>281.1735465                                                                                                                                                                                                </td><td>621.6810912                                                                                                                                                                                                </td><td>303.1563797                                                                                                                                                                                                </td><td>618.3970002                                                                                                                                                                                                </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>C13H28O4S;C5H24N6O7;C6H36N2OS4;C5H32N2O6S2;C6H149N3O;C6H28N6O2S2;C6H20N10O3;C14H24N4S;C4H28N2O11;C2H16N16O                                                                                                 </td><td>0.213133157656095;0.188528477554431;0.0904610811364913;0.0153249201505445;0.00630284951540268;0.0034763932119386;1.59844059461608e-05;1.0722494487467e-06;5.89236282336222e-07;4.9579451913951e-07         </td><td>-h                                                                                                                                                                                                         </td></tr>
	<tr><th scope=row>68</th><td>393.1716                                                                                                                                                                                                   </td><td>635.0364                                                                                                                                                                                                   </td><td>395.1835938                                                                                                                                                                                                </td><td>619.587                                                                                                                                                                                                    </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>C2H38N10O2S5;C17H34N2O2S3;C9H30N8O5S2;C24H26O5;C10H147N9;C3H38O18S;CH26N14O8S;C2H46N6OS7;C9H38N4O4S4;CH34N10O7S3                                                                                           </td><td>0.0100528371776825;0.0086298649790138;0.00342420594871812;0.00284091406492346;0.00180353678747936;0.00123950747396359;0.00115822764647621;0.000735054433696671;0.000153043142483949;3.38295532871088e-05   </td><td>-h+h                                                                                                                                                                                                       </td></tr>
	<tr><th scope=row>70</th><td>584.9976                                                                                                                                                                                                   </td><td>607.4660                                                                                                                                                                                                   </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>                                                                                                                                                                                                           </td><td>551.027242                                                                                                                                                                                                 </td><td>609.8323332                                                                                                                                                                                                </td><td>C6H30N8O7S7;C21H26O7S5;C7H50S13;H252N20O;C5H10N16O14S;C2H264N6O11;C7H22N2O24S;C7H147N9O2S5;C22H143NO2S3;C14H131N11O6                                                                                       </td><td>0.0143011334391296;0.0138339482548018;0.0131489026878466;0.0130979980188419;0.012976339505265;0.0128952208117631;0.0127738365856556;0.0123561517792582;0.0117285462058956;0.0116339281095651               </td><td>+cl+cl                                                                                                                                                                                                     </td></tr>
	<tr><th scope=row></th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
	<tr><th scope=row>8480</th><td>447.2387                                                                                                                                                                                                 </td><td>516.7540                                                                                                                                                                                                 </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>471.236393                                                                                                                                                                                               </td><td>503.89875                                                                                                                                                                                                </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>C11H157N9O2;C11H60S8;C25H36O7;C4H48O20S;C2H36N14O10S;C10H40N8O7S2;H24N28S;C3H56N6O3S7;C18H44N2O4S3;C3H48N10O4S5                                                                                          </td><td>0.0423594481961609;0.0421459991359883;0.0395912629328289;0.0380511037421569;0.0373005211688971;0.0372278013277935;0.0365529763819224;0.0325089423968653;0.0251318426373716;0.0231290436745857            </td><td>-h+na                                                                                                                                                                                                    </td></tr>
	<tr><th scope=row>8481</th><td>485.2166                                                                                                                                                                                                 </td><td>475.4000                                                                                                                                                                                                 </td><td>487.2320099;487.2317301                                                                                                                                                                                  </td><td>465.2955;484.57733334                                                                                                                                                                                    </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>C12H159N5O7;H292O12;C3H38N10O15S;C24H26N10O2;CH26N24O5S;C9H30N18O2S2;C11H42N4O12S2;C4H58N2O8S7;C5H167N7O4S3;C5H175N3O3S5                                                                                 </td><td>0.0303495573914185;0.0278988887962415;0.0277030630116962;0.0272644316226875;0.0272147292351598;0.0257412164883711;0.0252596683398079;0.0245576168460787;0.0206712289482381;0.0197481622184407            </td><td>-h+h                                                                                                                                                                                                     </td></tr>
	<tr><th scope=row>8484</th><td>447.2386                                                                                                                                                                                                 </td><td>521.4685                                                                                                                                                                                                 </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>471.236393                                                                                                                                                                                               </td><td>503.89875                                                                                                                                                                                                </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>C3H56N6O3S7;H24N28S;C2H36N14O10S;C4H48O20S;C11H157N9O2;C11H60S8;C10H48N4O6S4;C25H36O7;C10H40N8O7S2;C11H165N5OS2                                                                                          </td><td>0.044726334347973;0.0404870219855405;0.0397140731937029;0.0389435075393431;0.0346247218722069;0.0317307462550567;0.0294427300002791;0.0293197457813671;0.0271404576436358;0.0224925413144757             </td><td>-h+na                                                                                                                                                                                                    </td></tr>
	<tr><th scope=row>8489</th><td>365.1608                                                                                                                                                                                                 </td><td>339.0425                                                                                                                                                                                                 </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>389.159523                                                                                                                                                                                               </td><td>340.45150002                                                                                                                                                                                             </td><td>331.1943054                                                                                                                                                                                              </td><td>323.05699998                                                                                                                                                                                             </td><td>H159NO10S;C12H26N6O5S;C20H30O2S2;C5H34N8O2S4;C20H22N4O3;C5H26N12O3S2;C2H280N2S;CH163NO5S3;C13H30N6S3;H46O10S5                                                                                            </td><td>0.0344998067899936;0.0264163648500419;0.0113457548707398;0.00953082624532325;0.000563831870510436;0.000433626363069009;0.00041914827770756;0.000166750597198051;9.23598377738197e-05;6.16973377280164e-05</td><td>-h+na                                                                                                                                                                                                    </td></tr>
	<tr><th scope=row>8490</th><td>437.1812                                                                                                                                                                                                 </td><td>361.2940                                                                                                                                                                                                 </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>461.1797587                                                                                                                                                                                              </td><td>374.63599998                                                                                                                                                                                             </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>C8H159N5O3S2;C7H42N4O8S4;C14H34N2O11S;C12H22N16OS;H58N2O4S9;CH167N7S5;H155N11O6S;H50N6O5S7;CH42O22S;C8H151N9O4                                                                                           </td><td>0.0427394325006;0.0388272437258741;0.0350001534287154;0.0342326563905234;0.0324393631171757;0.0312771836861221;0.0295406126778947;0.0239481439632033;0.019271925536565;0.0161119200082054                </td><td>-h+na                                                                                                                                                                                                    </td></tr>
	<tr><th scope=row>8492</th><td>267.1970                                                                                                                                                                                                 </td><td>531.1545                                                                                                                                                                                                 </td><td>269.2112724;269.2112122                                                                                                                                                                                  </td><td>517.93850664;549.174                                                                                                                                                                                     </td><td>291.1954514;291.19561                                                                                                                                                                                    </td><td>544.00660002;531.77800002                                                                                                                                                                                </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>CH24N12O4;C9H36N2S3;C9H28N6OS;CH32N8O3S2;C16H28O3;CH40N4O2S4;C8H32N2O5S;H28N8O8;CH48OS6                                                                                                                  </td><td>0.245142707955244;0.160600348313884;0.113891584783429;0.0623019822301958;0.0505943585849312;0.00120007540008121;8.80649962313116e-05;6.47993504290524e-06;2.17999830200973e-06                           </td><td>-h+h                                                                                                                                                                                                     </td></tr>
	<tr><th scope=row>8493</th><td>293.1394                                                                                                                                                                                                 </td><td>599.9940                                                                                                                                                                                                 </td><td>295.1535721                                                                                                                                                                                              </td><td>583.77049998                                                                                                                                                                                             </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>259.1694285                                                                                                                                                                                              </td><td>603.9073332                                                                                                                                                                                              </td><td>C16H22O5;CH26N8O5S2;C2H143N9;C9H30N2O2S3;CH34N4O4S4;CH18N12O6;C8H26N2O7S;C9H22N6O3S;H22N8O10;C17H26S2                                                                                                    </td><td>0.128168655976145;0.124850841363548;0.103010766770094;0.0691613340712571;0.0216605404206293;0.0167192885224212;0.00513548890756591;0.00475438330389657;0.00111220324100208;0.00101309636952537           </td><td>-h+h                                                                                                                                                                                                     </td></tr>
	<tr><th scope=row>8495</th><td>333.1688                                                                                                                                                                                                 </td><td>531.1545                                                                                                                                                                                                 </td><td>335.1828003;335.1829376;335.1856537;335.1857529                                                                                                                                                          </td><td>531.58633332;514.48399998;521.74924998;539.88700002                                                                                                                                                      </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>C4H159NO3S2;C3H42O8S4;C8H22N12OS;C2H30N4O14;H18N18O4;C4H151N5O4;C3H34N4O9S2;C8H30N8S3;C23H26S;C2H38O13S2                                                                                                 </td><td>0.137770250305909;0.106206564982441;0.103324428705299;0.0590082086783307;0.0566770537260845;0.0279584681033552;0.0157522615928408;0.0149052594657311;0.0123205434918517;0.00518580772730026              </td><td>-h+h                                                                                                                                                                                                     </td></tr>
	<tr><th scope=row>8497</th><td>469.2578                                                                                                                                                                                                 </td><td>619.0960                                                                                                                                                                                                 </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>493.258783                                                                                                                                                                                               </td><td>634.3165998                                                                                                                                                                                              </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>C14H54N4S6;CH167N7O12;C13H34N12O7;H50N6O17S2;C9H171NO9S                                                                                                                                                  </td><td>8.4875413779573e-07;8.3180701277411e-07;4.59950237097821e-07;3.08605353254798e-07;1.59541836027669e-07                                                                                                   </td><td>-h+na                                                                                                                                                                                                    </td></tr>
	<tr><th scope=row>8501</th><td>431.2284                                                                                                                                                                                                 </td><td>530.6345                                                                                                                                                                                                 </td><td>433.244278                                                                                                                                                                                               </td><td>526.80550002                                                                                                                                                                                             </td><td>455.2258911                                                                                                                                                                                              </td><td>527.47489998                                                                                                                                                                                             </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>H173N7S5;H48O22S;C7H157N9O4;C6H48N4O8S4;C7H60O2S8;C21H36O9;C6H40N8O9S2;C7H165N5O3S2;C15H161N3OS;H165N11OS3                                                                                               </td><td>0.0440801536451777;0.0427750200942945;0.0376714619658549;0.0353102022332796;0.0342774928531842;0.0314677629420423;0.0289433783662324;0.0268431956525996;0.0239170164959113;0.0217370142291485            </td><td>-h+h+na                                                                                                                                                                                                  </td></tr>
	<tr><th scope=row>8502</th><td>327.1802                                                                                                                                                                                                 </td><td>644.7460                                                                                                                                                                                                 </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>293.2083435;293.2091077;293.2114062                                                                                                                                                                      </td><td>644.5748334;630.1296666;651.230286                                                                                                                                                                       </td><td>C5H44N2S5;C12H36O3S2;C12H28N4O4;C4H32N6O6S;C5H36N6OS3;C4H40N2O5S3;C5H28N10O2S;C5H157N3S;C11H32O8;CH157N3O5                                                                                               </td><td>0.355579802050023;0.17415669330768;0.16389205451921;0.0726673629097657;0.0551753121844459;0.00215242625442057;0.00134178097540952;0.000700111120659247;0.000218922032574055;7.93931974782461e-07         </td><td>+cl+cl                                                                                                                                                                                                   </td></tr>
	<tr><th scope=row>8504</th><td>495.2728                                                                                                                                                                                                 </td><td>628.2570                                                                                                                                                                                                 </td><td>497.2894669                                                                                                                                                                                              </td><td>644.0515002                                                                                                                                                                                              </td><td>519.2710673                                                                                                                                                                                              </td><td>642.9979998                                                                                                                                                                                              </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>H185N5O3S6;C6H60N2O11S5;C4H48N16OS5;C19H44N8OS3;C11H32N18O5;C13H44N4O15;C34H40OS;C7H177N3O6S3;C7H169N7O7S;C13H52O14S2                                                                                    </td><td>0.029903267604317;0.0260668573369028;0.0255980203387975;0.0241391813205893;0.0238803356375288;0.0234215095730097;0.0227034681656126;0.0212920579046503;0.0190768009098479;0.0171183977155568             </td><td>-h+h+na                                                                                                                                                                                                  </td></tr>
	<tr><th scope=row>8506</th><td>361.1660                                                                                                                                                                                                 </td><td>492.4180                                                                                                                                                                                                 </td><td>363.1802848;363.1805634;363.1805534                                                                                                                                                                      </td><td>487.60742856;474.5346;503.61700002                                                                                                                                                                       </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>C6H42N4S6;C13H34N2O3S3;C5H22N12O7;CH159NO9S;C5H30N8O6S2;C13H26N6O4S;C20H26O6;H42O14S3;C6H147N9O;C21H30OS2                                                                                                </td><td>0.0857508248141316;0.0745551901481816;0.072039062325062;0.0513188535194853;0.0428327490744316;0.0409197475142286;0.0380170454415771;0.0348222593482374;0.0281963300169029;0.0196746556826219             </td><td>-h+h                                                                                                                                                                                                     </td></tr>
	<tr><th scope=row>8514</th><td>291.1243                                                                                                                                                                                                 </td><td>500.5315                                                                                                                                                                                                 </td><td>293.1374179;293.1388664;293.1367188                                                                                                                                                                      </td><td>499.24309092;514.1085;481.78466664                                                                                                                                                                       </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>CH16N12O6;C9H28N2O2S3;CH24N8O5S2;C16H20O5;C2H141N9;CH32N4O4S4;C8H24N2O7S;H20N8O10;CH40O3S6                                                                                                               </td><td>0.173146193680868;0.0643109294664466;0.0246391569802795;0.0200583480061421;0.0119951393619763;0.000573714393487222;5.18998307454292e-05;4.85533987976917e-06;1.81737376929762e-06                        </td><td>-h+h                                                                                                                                                                                                     </td></tr>
	<tr><th scope=row>8517</th><td>399.2023                                                                                                                                                                                                 </td><td>491.8940                                                                                                                                                                                                 </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>365.241745                                                                                                                                                                                               </td><td>502.98049998                                                                                                                                                                                             </td><td>C5H286O;C8H32N10O4S;C16H36N4OS2;CH40N12OS4;C2H40N2O17;H28N16O7;CH48N8S6;C16H44S4;C4H161N3O7;C8H40N6O3S3                                                                                                  </td><td>0.0781290017285997;0.0773401851986849;0.0767579555896741;0.0706597725700206;0.0480291258709265;0.0464184207037559;0.0366852878220367;0.0324688907039047;0.0201203471683547;0.0150827613856466            </td><td>+cl+cl                                                                                                                                                                                                   </td></tr>
	<tr><th scope=row>8521</th><td>365.1400                                                                                                                                                                                                 </td><td>610.9825                                                                                                                                                                                                 </td><td>367.1531909                                                                                                                                                                                              </td><td>623.3248398                                                                                                                                                                                              </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>C7H18N12O6;C3H155NO8S;C15H22N6O3S;H26N14O3S3;C2H38O13S3;H34N10O2S5;C15H30N2O2S3;C23H26S2;C8H30N8S4;C7H26N8O5S2                                                                                           </td><td>0.0736223342796792;0.066207147563185;0.0560600159735918;0.0512086291954716;0.0496998086440372;0.037419476500957;0.033454078324809;0.0321305945583828;0.0285143455500227;0.0164699763337216               </td><td>-h+h                                                                                                                                                                                                     </td></tr>
	<tr><th scope=row>8522</th><td>243.1602                                                                                                                                                                                                 </td><td>413.6365                                                                                                                                                                                                 </td><td>245.1750259                                                                                                                                                                                              </td><td>411.627                                                                                                                                                                                                  </td><td>267.1564353;267.1566696;267.1594635;267.1596344;267.1592611                                                                                                                                              </td><td>411.25585716;396.05650002;401.4705;427.96819998;417.55933332                                                                                                                                             </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>C13H24O4;C6H32N2OS3;C6H24N6O2S;C5H28N2O6S                                                                                                                                                                </td><td>0.431298669214944;0.218684606500025;0.00611095714830009;0.00523707335006016                                                                                                                              </td><td>-h+h+na                                                                                                                                                                                                  </td></tr>
	<tr><th scope=row>8523</th><td>301.1655                                                                                                                                                                                                 </td><td>357.6255                                                                                                                                                                                                 </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>325.1638184                                                                                                                                                                                              </td><td>353.0055                                                                                                                                                                                                 </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>C8H34N2O3S3;CH42N4S6;H22N12O7;C8H26N6O4S;C16H30OS2;CH34N8OS4;C16H22N4O2;CH26N12O2S2                                                                                                                      </td><td>0.053858424744118;0.0171213422968636;0.0109699498602663;0.00282137390954389;0.000549694561792814;0.000394900108815436;2.23906843174615e-06;1.40313038539503e-06                                          </td><td>-h+na                                                                                                                                                                                                    </td></tr>
	<tr><th scope=row>8524</th><td>327.1817                                                                                                                                                                                                 </td><td>503.6720                                                                                                                                                                                                 </td><td>329.1936698;329.19369                                                                                                                                                                                    </td><td>491.09258622;520.9272222                                                                                                                                                                                 </td><td>351.1811638                                                                                                                                                                                              </td><td>507.03349998                                                                                                                                                                                             </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>C3H157N5S2;C9H32N2O8S;CH28N8O11;C2H48O4S6;CH36N4O10S2;C14H20N10                                                                                                                                          </td><td>0.00151715674094213;0.000627795519592861;0.000111669642440961;5.43450953361327e-05;4.33993216966161e-07;2.36218323234734e-07                                                                             </td><td>-h+h                                                                                                                                                                                                     </td></tr>
	<tr><th scope=row>8527</th><td>299.1137                                                                                                                                                                                                 </td><td>302.1385                                                                                                                                                                                                 </td><td>301.125473                                                                                                                                                                                               </td><td>308.77300002                                                                                                                                                                                             </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>C11H12N10O                                                                                                                                                                                               </td><td>2.29797451799277e-06                                                                                                                                                                                     </td><td>-h+h                                                                                                                                                                                                     </td></tr>
	<tr><th scope=row>8528</th><td>389.1605                                                                                                                                                                                                 </td><td>353.1760                                                                                                                                                                                                 </td><td>391.1756104;391.1757355                                                                                                                                                                                  </td><td>341.28379998;368.71699998                                                                                                                                                                                </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>C7H147N9O2;C7H50S8;C21H26O7;H38O20S;C6H30N8O7S2;C14H34N2O4S3;C6H38N4O6S4;C7H155N5OS2;C7H42N4OS6;C6H22N12O8                                                                                               </td><td>0.0692691826371632;0.0684248002501042;0.0636245566847554;0.0611729786956903;0.0591969521854864;0.037003967792984;0.0271261266148571;0.0181601375706346;0.0177235407157656;0.0133889951483034             </td><td>-h+h                                                                                                                                                                                                     </td></tr>
	<tr><th scope=row>8529</th><td>255.1237                                                                                                                                                                                                 </td><td>278.5820                                                                                                                                                                                                 </td><td>257.1335144                                                                                                                                                                                              </td><td>293.86000002                                                                                                                                                                                             </td><td>279.1199493                                                                                                                                                                                              </td><td>276.5865                                                                                                                                                                                                 </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>C13H20O5;C6H28N2O2S3;C5H24N2O7S;C6H20N6O3S;C14H24S2                                                                                                                                                      </td><td>0.261342136146197;0.0905583068982512;0.0211636998573177;0.00161873960830912;0.000168614326355066                                                                                                         </td><td>-h+na                                                                                                                                                                                                    </td></tr>
	<tr><th scope=row>8530</th><td>267.1603                                                                                                                                                                                                 </td><td>489.0155                                                                                                                                                                                                 </td><td>269.1749786;269.1747793                                                                                                                                                                                  </td><td>490.7748;469.03366668                                                                                                                                                                                    </td><td>291.1579208;291.1594353;291.1582825;291.1574707                                                                                                                                                          </td><td>469.86825;479.00824998;502.61860002;488.36119998                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>C8H32N2OS3;H28N8O4S2;C15H24O4;H20N12O5;C8H24N6O2S;C16H20N4;CH24N12S2                                                                                                                                     </td><td>0.238849635439978;0.165126662932731;0.144251627065407;0.0715969706901804;0.0222657612836073;2.03559220634049e-05;1.25282519416804e-05                                                                    </td><td>-h+h+na                                                                                                                                                                                                  </td></tr>
	<tr><th scope=row>8533</th><td>351.1812                                                                                                                                                                                                 </td><td>425.6760                                                                                                                                                                                                 </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>375.1785583;375.1806946;375.1801758                                                                                                                                                                      </td><td>420.66100002;411.99033336;426.29749998                                                                                                                                                                   </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>C5H149N9O;C19H28O6;C4H32N8O6S2;C12H36N2O3S3;C4H40N4O5S4;C5H44N4S6;C5H157N5S2;C4H24N12O7;C11H32N2O8S;H161NO9S                                                                                             </td><td>0.100745198724658;0.100662887542405;0.0931225543810395;0.0554716436848391;0.0331910547024012;0.0240731520388924;0.0204768589842588;0.0174357071196916;0.0121832946543344;0.00958601737606203             </td><td>-h+na                                                                                                                                                                                                    </td></tr>
	<tr><th scope=row>8534</th><td>325.1660                                                                                                                                                                                                 </td><td>418.6090                                                                                                                                                                                                 </td><td>327.1779709                                                                                                                                                                                              </td><td>430.47100002                                                                                                                                                                                             </td><td>349.1655477;349.1655762                                                                                                                                                                                  </td><td>429.68266668;414.86380002                                                                                                                                                                                </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>C3H155N5S2;C9H30N2O8S;CH26N8O11;C2H46O4S6;CH34N4O10S2;C14H18N10;C2H151N5O5                                                                                                                               </td><td>0.00220170864862805;0.000937882049971275;0.000175218292843879;8.68292054580672e-05;7.64190518173236e-07;4.20122662382886e-07;1.6458814077825e-07                                                         </td><td>-h+h                                                                                                                                                                                                     </td></tr>
	<tr><th scope=row>8539</th><td>269.1395                                                                                                                                                                                                 </td><td>365.2155                                                                                                                                                                                                 </td><td>271.1544266;271.1527023                                                                                                                                                                                  </td><td>363.20650002;380.48749998                                                                                                                                                                                </td><td>293.1362061;293.1366272                                                                                                                                                                                  </td><td>367.97419998;347.59433334                                                                                                                                                                                </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>C14H22O5;C7H30N2O2S3;H143N9;C7H22N6O3S;C6H26N2O7S;C15H26S2;H30N8S4;C15H18N4O;H22N12OS2                                                                                                                   </td><td>0.171903703424163;0.146822070426921;0.129060178603037;0.00941643940628411;0.0027669959603506;0.00178865963132253;0.00126978081120653;4.97809275511703e-06;2.98103899444647e-06                           </td><td>-h+h+na                                                                                                                                                                                                  </td></tr>
	<tr><th scope=row>8540</th><td>341.1969                                                                                                                                                                                                 </td><td>447.9230                                                                                                                                                                                                 </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>365.1940842;365.1953583                                                                                                                                                                                  </td><td>467.106;449.84050002                                                                                                                                                                                     </td><td>307.2378387;307.2377243                                                                                                                                                                                  </td><td>464.77075002;432.0555                                                                                                                                                                                    </td><td>C4H151N9O;C18H30O6;C3H34N8O6S2;C11H38N2O3S3;C3H42N4O5S4;C4H159N5S2;C4H46N4S6;C10H34N2O8S;C3H26N12O7;C2H30N8O11                                                                                           </td><td>0.115504628597588;0.0963520762374998;0.0883145731165531;0.0495984780423587;0.039734839442959;0.0246216160449267;0.0197035051141986;0.0146626498273976;0.013812180746956;0.00505778387737889              </td><td>-h+na                                                                                                                                                                                                    </td></tr>
	<tr><th scope=row>8542</th><td>407.1708                                                                                                                                                                                                 </td><td>447.3995                                                                                                                                                                                                 </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>373.2044678                                                                                                                                                                                              </td><td>449.85                                                                                                                                                                                                   </td><td>C3H36N2O17;CH24N16O7;C9H28N10O4S;C6H282O;C2H44N8S6;C17H40S4;C17H32N4OS2;C2H36N12OS4;C9H36N6O3S3;CH32N12O6S2                                                                                              </td><td>0.06826953674281;0.0666419916692295;0.0630410286161741;0.0624005177778752;0.0563092368653317;0.0515311041695114;0.0379612013116934;0.0340280009043106;0.0290744063629663;0.0139874321473767              </td><td>+cl+cl                                                                                                                                                                                                   </td></tr>
	<tr><th scope=row>8545</th><td>345.1708                                                                                                                                                                                                 </td><td>457.0835                                                                                                                                                                                                 </td><td>347.1862061;347.1862418                                                                                                                                                                                  </td><td>445.12000002;465.59227272                                                                                                                                                                                </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>                                                                                                                                                                                                         </td><td>C5H30N8O5S2;C20H26O5;C6H147N9;C13H34N2O2S3;C5H22N12O6;C5H38N4O4S4;CH159NO8S;C13H26N6O3S;H42O13S3;C12H30N2O7S                                                                                             </td><td>0.101374800906851;0.0940822389831023;0.0775240548734125;0.0666095421479958;0.023089611388186;0.0213308381844966;0.013191363692798;0.00918900572169441;0.00713529461582843;0.00685909952675112            </td><td>-h+h                                                                                                                                                                                                     </td></tr>
	<tr><th scope=row>8546</th><td>379.1761                                                                                                                                                                                                 </td><td>498.9605                                                                                                                                                                                                 </td><td>381.1889877                                                                                                                                                                                              </td><td>489.35350002                                                                                                                                                                                             </td><td>403.1733958                                                                                                                                                                                              </td><td>487.53166668                                                                                                                                                                                             </td><td>345.2042618                                                                                                                                                                                              </td><td>504.421125                                                                                                                                                                                               </td><td>C6H52S8;C6H149N9O2;C20H28O7;C5H32N8O7S2;C5H40N4O6S4;C6H157N5OS2;C12H32N2O9S;C4H28N8O12;C2H16N22O2;C5H48O5S6                                                                                              </td><td>0.0804917021849592;0.0776043832682627;0.0748164977646689;0.0695720454966455;0.0288826085746968;0.0189025432872817;0.0120077818110771;0.00478419542536664;0.00451007505224;0.00322574391908907            </td><td>-h+h+na                                                                                                                                                                                                  </td></tr>
</tbody>
</table>




```R
# Output table
write.table(allnegs, "match_adduct_H_and_Na_Cl_with_formulas.tsv", row.names=FALSE, sep="\t")
```


```R
# Filter formulas and replace in the old matrix
allnegs[,"Scores"] <- as.character(allnegs[,"Scores"])
allnegs[,"Formulas"] <- as.character(allnegs[,"Formulas"])
allnegs[,"Scores"] <- sapply(1:nrow(allnegs), function(x) paste(strsplit(as.character(allnegs[x,"Scores"]), ";")[[1]][unlist(lapply(lapply(strsplit(as.character(allnegs[x,"Formulas"]), ";")[[1]], split.fm) , filter.rules) )], collapse=";"))
allnegs[,"Formulas"] <- sapply(allnegs[,"Formulas"], function(x) paste(strsplit(x, ";")[[1]][unlist(lapply(lapply(strsplit(x, ";")[[1]], split.fm) , filter.rules) )], collapse=";") )
```


```R
allnegs
```


<table>
<thead><tr><th></th><th scope=col>row.m.z</th><th scope=col>row.retention.time</th><th scope=col>mass_on_pos_tableH</th><th scope=col>rt_on_pos_tableH</th><th scope=col>mass_on_pos_tableNa</th><th scope=col>rt_on_pos_tableNa</th><th scope=col>mass_on_pos_tableCl</th><th scope=col>rt_on_pos_tableCl</th><th scope=col>Formulas</th><th scope=col>Scores</th><th scope=col>Flag</th></tr></thead>
<tbody>
	<tr><th scope=row>3</th><td>265.1478                                                                     </td><td>604.9176                                                                     </td><td>267.1593434;267.1591933                                                      </td><td>607.786818;592.86199998                                                      </td><td>289.1538153;289.141276                                                       </td><td>613.5690486;600.0843336                                                      </td><td>                                                                             </td><td>                                                                             </td><td>C12H26O4S;C5H18N10O3                                                         </td><td>0.291728046899418;8.32079874865639e-06                                       </td><td>-h                                                                           </td></tr>
	<tr><th scope=row>4</th><td>331.2491                                                                     </td><td>535.4694                                                                     </td><td>333.2637768                                                                  </td><td>535.2827625                                                                  </td><td>355.246215                                                                   </td><td>535.27910256                                                                 </td><td>                                                                             </td><td>                                                                             </td><td>C18H36O5;C11H36N6O3S;C10H40N2O7S;C19H40S2                                    </td><td>0.103916652331871;0.0151462362298204;0.00492264716599492;0.00490877721265675 </td><td>-h+h+na                                                                      </td></tr>
	<tr><th scope=row>7</th><td>299.2591                                                                     </td><td>641.8074                                                                     </td><td>                                                                             </td><td>                                                                             </td><td>323.2580719;323.2580414                                                      </td><td>659.7529998;623.3655                                                         </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>-h+na                                                                        </td></tr>
	<tr><th scope=row>8</th><td>221.1546                                                                     </td><td>617.2219                                                                     </td><td>223.1697655                                                                  </td><td>617.3025                                                                     </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>C14H22O2;C7H22N6S                                                            </td><td>0.309136101869248;0.000503735287817614                                       </td><td>-h+h                                                                         </td></tr>
	<tr><th scope=row>10</th><td>233.1546                                                                     </td><td>618.5047                                                                     </td><td>235.1695874;235.1696329                                                      </td><td>618.321198;605.569875                                                        </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>C15H22O2;C7H26N2O4S;C8H22N6S                                                 </td><td>0.220536182010116;0.0146950878027628;0.000521971565053549                    </td><td>-h+h                                                                         </td></tr>
	<tr><th scope=row>11</th><td>297.1528                                                                     </td><td>606.4535                                                                     </td><td>299.1648356                                                                  </td><td>605.8429998                                                                  </td><td>                                                                             </td><td>                                                                             </td><td>263.1980866                                                                  </td><td>623.9719554                                                                  </td><td>                                                                             </td><td>                                                                             </td><td>-h+h                                                                         </td></tr>
	<tr><th scope=row>12</th><td>242.1762                                                                     </td><td>445.2437                                                                     </td><td>244.1909996                                                                  </td><td>445.07591142                                                                 </td><td>266.1727686                                                                  </td><td>445.04526084                                                                 </td><td>                                                                             </td><td>                                                                             </td><td>C13H25NO3                                                                    </td><td>0.390273094575672                                                            </td><td>-h+h+na                                                                      </td></tr>
	<tr><th scope=row>13</th><td>309.1742                                                                     </td><td>638.6725                                                                     </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>275.2036816;275.2217331;275.2214966                                          </td><td>628.247238;650.9835;635.9290002                                              </td><td>C17H26N2O;C9H30N4O3S                                                         </td><td>0.103917178730147;0.000479907506648241                                       </td><td>+cl+cl                                                                       </td></tr>
	<tr><th scope=row>14</th><td>293.1759                                                                     </td><td>577.6112                                                                     </td><td>295.1902665;295.189859;295.189785                                            </td><td>577.29411762;558.82639998;591.02575002                                       </td><td>317.1752319;317.1743774                                                      </td><td>569.90266668;587.52466668                                                    </td><td>                                                                             </td><td>                                                                             </td><td>C18H22N4                                                                     </td><td>3.37295532309679e-05                                                         </td><td>-h+h+na                                                                      </td></tr>
	<tr><th scope=row>15</th><td>293.1760                                                                     </td><td>545.5763                                                                     </td><td>295.189859;295.1903168                                                       </td><td>558.82639998;532.65379998                                                    </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>C17H26O4;C10H26N6O2S;C9H30N2O6S                                              </td><td>0.141826512197692;0.0223281531515091;0.00270898187166745                     </td><td>-h+h                                                                         </td></tr>
	<tr><th scope=row>16</th><td>243.1601                                                                     </td><td>520.4327                                                                     </td><td>245.17491                                                                    </td><td>520.09699998                                                                 </td><td>267.1593628;267.1569722;267.15942                                            </td><td>539.23219998;524.43533334;514.4745                                           </td><td>                                                                             </td><td>                                                                             </td><td>C13H24O4;C6H24N6O2S                                                          </td><td>0.36749520480134;0.00189597396595343                                         </td><td>-h+h                                                                         </td></tr>
	<tr><th scope=row>17</th><td>271.1915                                                                     </td><td>582.4374                                                                     </td><td>273.2060394                                                                  </td><td>582.01549998                                                                 </td><td>295.1902665;295.189785;295.1905243                                           </td><td>577.29411762;591.02575002;600.5896002                                        </td><td>                                                                             </td><td>                                                                             </td><td>C16H24N4                                                                     </td><td>2.85014578684413e-06                                                         </td><td>-h+h+na                                                                      </td></tr>
	<tr><th scope=row>18</th><td>257.1759                                                                     </td><td>559.6350                                                                     </td><td>259.1907196;259.1904297                                                      </td><td>575.21800002;559.39971426                                                    </td><td>281.1744607;281.1749246                                                      </td><td>570.75836364;556.6987143                                                     </td><td>                                                                             </td><td>                                                                             </td><td>C15H22N4                                                                     </td><td>2.20188080139674e-06                                                         </td><td>-h+h+na                                                                      </td></tr>
	<tr><th scope=row>19</th><td>285.2072                                                                     </td><td>518.3619                                                                     </td><td>                                                                             </td><td>                                                                             </td><td>309.2033963                                                                  </td><td>517.25944446                                                                 </td><td>                                                                             </td><td>                                                                             </td><td>C16H30O4;C9H30N6O2S                                                          </td><td>0.166161060524665;0.0135749755808639                                         </td><td>-h+na                                                                        </td></tr>
	<tr><th scope=row>24</th><td>285.2071                                                                     </td><td>599.2204                                                                     </td><td>287.2216237                                                                  </td><td>599.205                                                                      </td><td>309.2059501;309.2060699;309.2060406                                          </td><td>617.1169428;602.5075002;591.82230768                                         </td><td>                                                                             </td><td>                                                                             </td><td>C17H26N4                                                                     </td><td>3.76912179923972e-06                                                         </td><td>-h+h+na                                                                      </td></tr>
	<tr><th scope=row>25</th><td>313.2385                                                                     </td><td>581.4515                                                                     </td><td>                                                                             </td><td>                                                                             </td><td>337.2349138                                                                  </td><td>580.67322498                                                                 </td><td>                                                                             </td><td>                                                                             </td><td>C18H34O4;C11H34N6O2S;C10H38N2O6S;C19H30N4                                    </td><td>0.163570500471558;0.0163680474028829;0.00646174023858844;5.39532681284467e-05</td><td>-h+na                                                                        </td></tr>
	<tr><th scope=row>26</th><td>271.2278                                                                     </td><td>611.3241                                                                     </td><td>                                                                             </td><td>                                                                             </td><td>295.2265259;295.2264191;295.2265383;295.2264303                              </td><td>627.7194;619.4422002;599.99816664;605.8450002                                </td><td>                                                                             </td><td>                                                                             </td><td>C16H32O3;C9H32N6OS                                                           </td><td>0.213777028551204;0.0036806144322976                                         </td><td>-h                                                                           </td></tr>
	<tr><th scope=row>27</th><td>277.1444                                                                     </td><td>595.0884                                                                     </td><td>279.159165;279.1565573;279.1593689                                           </td><td>606.9973794;577.15693104;591.27679998                                        </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>C16H22O4;C8H26N2O6S;C9H22N6O2S                                               </td><td>0.182060335897966;0.02759814238266;0.00179612642881566                       </td><td>-h+h                                                                         </td></tr>
	<tr><th scope=row>33</th><td>263.1652                                                                     </td><td>584.8324                                                                     </td><td>265.1801619;265.1800598;265.180027                                           </td><td>584.0872836;593.8455;568.73925                                               </td><td>287.1640472                                                                  </td><td>573.38650002                                                                 </td><td>                                                                             </td><td>                                                                             </td><td>C16H24O3;C8H28N2O5S;C9H24N6OS                                                </td><td>0.209553679217897;0.00958933696657658;0.0025320013343196                     </td><td>-h+h                                                                         </td></tr>
	<tr><th scope=row>36</th><td>549.0164                                                                     </td><td>599.6883                                                                     </td><td>551.027242                                                                   </td><td>609.8323332                                                                  </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>C20H10N10O6S2;C35H6N2O6                                                      </td><td>0.000908123645069232;0.000799677104524594                                    </td><td>-h+h                                                                         </td></tr>
	<tr><th scope=row>41</th><td>215.1288                                                                     </td><td>427.4029                                                                     </td><td>217.1439501                                                                  </td><td>426.63883332                                                                 </td><td>239.1282568;239.1282142                                                      </td><td>419.32825002;434.07028572                                                    </td><td>181.1589308;181.158933                                                       </td><td>444.877125;407.97833334                                                      </td><td>C11H20O4                                                                     </td><td>0.753865749376428                                                            </td><td>-h+h                                                                         </td></tr>
	<tr><th scope=row>42</th><td>299.2227                                                                     </td><td>613.5738                                                                     </td><td>                                                                             </td><td>                                                                             </td><td>323.2213402                                                                  </td><td>628.2132498                                                                  </td><td>                                                                             </td><td>                                                                             </td><td>C10H32N6O2S;C18H28N4                                                         </td><td>0.00384727000320164;2.63425632277403e-06                                     </td><td>-h+na                                                                        </td></tr>
	<tr><th scope=row>46</th><td>311.1687                                                                     </td><td>633.4072                                                                     </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>277.2138352;277.2161987                                                      </td><td>637.2686622;617.772                                                          </td><td>C12H28N4OS                                                                   </td><td>0.0011923078550809                                                           </td><td>+cl+cl                                                                       </td></tr>
	<tr><th scope=row>51</th><td>271.2279                                                                     </td><td>655.6806                                                                     </td><td>                                                                             </td><td>                                                                             </td><td>295.2265659;295.2264592;295.2263184                                          </td><td>636.8091114;655.0003074;643.5154998                                          </td><td>                                                                             </td><td>                                                                             </td><td>C16H32O3;C9H32N6OS                                                           </td><td>0.19529695335953;0.00675221592879881                                         </td><td>-h                                                                           </td></tr>
	<tr><th scope=row>54</th><td>253.1445                                                                     </td><td>509.3066                                                                     </td><td>255.1594198;255.1568666;255.1592763                                          </td><td>508.79663952;513.2040714;497.64633336                                        </td><td>277.1427841;277.1415666                                                      </td><td>516.4095;498.31170588                                                        </td><td>219.1876157                                                                  </td><td>512.39766666                                                                 </td><td>C7H22N6O2S;C15H18N4                                                          </td><td>0.00596977133914822;8.55326541440371e-07                                     </td><td>-h+h+na                                                                      </td></tr>
	<tr><th scope=row>57</th><td>367.2463                                                                     </td><td>641.7301                                                                     </td><td>                                                                             </td><td>                                                                             </td><td>391.2461446;391.2461466                                                      </td><td>628.1606664;647.8743078                                                      </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>-h+na                                                                        </td></tr>
	<tr><th scope=row>59</th><td>599.0134                                                                     </td><td>604.5809                                                                     </td><td>601.0293318                                                                  </td><td>621.8419998                                                                  </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>C18H12N6O18                                                                  </td><td>0.00872648666752807                                                          </td><td>-h+h                                                                         </td></tr>
	<tr><th scope=row>62</th><td>279.1635                                                                     </td><td>637.5343                                                                     </td><td>281.1735465                                                                  </td><td>621.6810912                                                                  </td><td>303.1563797                                                                  </td><td>618.3970002                                                                  </td><td>                                                                             </td><td>                                                                             </td><td>C13H28O4S;C6H20N10O3;C14H24N4S                                               </td><td>0.213133157656095;1.59844059461608e-05;1.0722494487467e-06                   </td><td>-h                                                                           </td></tr>
	<tr><th scope=row>68</th><td>393.1716                                                                     </td><td>635.0364                                                                     </td><td>395.1835938                                                                  </td><td>619.587                                                                      </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>C9H30N8O5S2;C24H26O5                                                         </td><td>0.00342420594871812;0.00284091406492346                                      </td><td>-h+h                                                                         </td></tr>
	<tr><th scope=row>70</th><td>584.9976                                                                     </td><td>607.4660                                                                     </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>                                                                             </td><td>551.027242                                                                   </td><td>609.8323332                                                                  </td><td>                                                                             </td><td>                                                                             </td><td>+cl+cl                                                                       </td></tr>
	<tr><th scope=row></th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
	<tr><th scope=row>8480</th><td>447.2387                                                                      </td><td>516.7540                                                                      </td><td>                                                                              </td><td>                                                                              </td><td>471.236393                                                                    </td><td>503.89875                                                                     </td><td>                                                                              </td><td>                                                                              </td><td>C25H36O7;C10H40N8O7S2                                                         </td><td>0.0395912629328289;0.0372278013277935                                         </td><td>-h+na                                                                         </td></tr>
	<tr><th scope=row>8481</th><td>485.2166                                                                      </td><td>475.4000                                                                      </td><td>487.2320099;487.2317301                                                       </td><td>465.2955;484.57733334                                                         </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>C24H26N10O2                                                                   </td><td>0.0272644316226875                                                            </td><td>-h+h                                                                          </td></tr>
	<tr><th scope=row>8484</th><td>447.2386                                                                      </td><td>521.4685                                                                      </td><td>                                                                              </td><td>                                                                              </td><td>471.236393                                                                    </td><td>503.89875                                                                     </td><td>                                                                              </td><td>                                                                              </td><td>C25H36O7;C10H40N8O7S2                                                         </td><td>0.0293197457813671;0.0271404576436358                                         </td><td>-h+na                                                                         </td></tr>
	<tr><th scope=row>8489</th><td>365.1608                                                                      </td><td>339.0425                                                                      </td><td>                                                                              </td><td>                                                                              </td><td>389.159523                                                                    </td><td>340.45150002                                                                  </td><td>331.1943054                                                                   </td><td>323.05699998                                                                  </td><td>C12H26N6O5S;C20H30O2S2;C20H22N4O3                                             </td><td>0.0264163648500419;0.0113457548707398;0.000563831870510436                    </td><td>-h+na                                                                         </td></tr>
	<tr><th scope=row>8490</th><td>437.1812                                                                      </td><td>361.2940                                                                      </td><td>                                                                              </td><td>                                                                              </td><td>461.1797587                                                                   </td><td>374.63599998                                                                  </td><td>                                                                              </td><td>                                                                              </td><td>C14H34N2O11S                                                                  </td><td>0.0350001534287154                                                            </td><td>-h+na                                                                         </td></tr>
	<tr><th scope=row>8492</th><td>267.1970                                                                      </td><td>531.1545                                                                      </td><td>269.2112724;269.2112122                                                       </td><td>517.93850664;549.174                                                          </td><td>291.1954514;291.19561                                                         </td><td>544.00660002;531.77800002                                                     </td><td>                                                                              </td><td>                                                                              </td><td>C9H28N6OS;C16H28O3;C8H32N2O5S                                                 </td><td>0.113891584783429;0.0505943585849312;8.80649962313116e-05                     </td><td>-h+h                                                                          </td></tr>
	<tr><th scope=row>8493</th><td>293.1394                                                                      </td><td>599.9940                                                                      </td><td>295.1535721                                                                   </td><td>583.77049998                                                                  </td><td>                                                                              </td><td>                                                                              </td><td>259.1694285                                                                   </td><td>603.9073332                                                                   </td><td>C16H22O5;C8H26N2O7S;C9H22N6O3S;C17H26S2                                       </td><td>0.128168655976145;0.00513548890756591;0.00475438330389657;0.00101309636952537 </td><td>-h+h                                                                          </td></tr>
	<tr><th scope=row>8495</th><td>333.1688                                                                      </td><td>531.1545                                                                      </td><td>335.1828003;335.1829376;335.1856537;335.1857529                               </td><td>531.58633332;514.48399998;521.74924998;539.88700002                           </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>C23H26S                                                                       </td><td>0.0123205434918517                                                            </td><td>-h+h                                                                          </td></tr>
	<tr><th scope=row>8497</th><td>469.2578                                                                      </td><td>619.0960                                                                      </td><td>                                                                              </td><td>                                                                              </td><td>493.258783                                                                    </td><td>634.3165998                                                                   </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>-h+na                                                                         </td></tr>
	<tr><th scope=row>8501</th><td>431.2284                                                                      </td><td>530.6345                                                                      </td><td>433.244278                                                                    </td><td>526.80550002                                                                  </td><td>455.2258911                                                                   </td><td>527.47489998                                                                  </td><td>                                                                              </td><td>                                                                              </td><td>C21H36O9                                                                      </td><td>0.0314677629420423                                                            </td><td>-h+h+na                                                                       </td></tr>
	<tr><th scope=row>8502</th><td>327.1802                                                                      </td><td>644.7460                                                                      </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>293.2083435;293.2091077;293.2114062                                           </td><td>644.5748334;630.1296666;651.230286                                            </td><td>C12H36O3S2;C12H28N4O4;C11H32O8                                                </td><td>0.17415669330768;0.16389205451921;0.000218922032574055                        </td><td>+cl+cl                                                                        </td></tr>
	<tr><th scope=row>8504</th><td>495.2728                                                                      </td><td>628.2570                                                                      </td><td>497.2894669                                                                   </td><td>644.0515002                                                                   </td><td>519.2710673                                                                   </td><td>642.9979998                                                                   </td><td>                                                                              </td><td>                                                                              </td><td>C34H40OS                                                                      </td><td>0.0227034681656126                                                            </td><td>-h+h+na                                                                       </td></tr>
	<tr><th scope=row>8506</th><td>361.1660                                                                      </td><td>492.4180                                                                      </td><td>363.1802848;363.1805634;363.1805534                                           </td><td>487.60742856;474.5346;503.61700002                                            </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>C13H26N6O4S;C20H26O6;C21H30OS2                                                </td><td>0.0409197475142286;0.0380170454415771;0.0196746556826219                      </td><td>-h+h                                                                          </td></tr>
	<tr><th scope=row>8514</th><td>291.1243                                                                      </td><td>500.5315                                                                      </td><td>293.1374179;293.1388664;293.1367188                                           </td><td>499.24309092;514.1085;481.78466664                                            </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>C16H20O5;C8H24N2O7S                                                           </td><td>0.0200583480061421;5.18998307454292e-05                                       </td><td>-h+h                                                                          </td></tr>
	<tr><th scope=row>8517</th><td>399.2023                                                                      </td><td>491.8940                                                                      </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>365.241745                                                                    </td><td>502.98049998                                                                  </td><td>C8H32N10O4S;C16H36N4OS2                                                       </td><td>0.0773401851986849;0.0767579555896741                                         </td><td>+cl+cl                                                                        </td></tr>
	<tr><th scope=row>8521</th><td>365.1400                                                                      </td><td>610.9825                                                                      </td><td>367.1531909                                                                   </td><td>623.3248398                                                                   </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>C15H22N6O3S;C23H26S2;C7H26N8O5S2                                              </td><td>0.0560600159735918;0.0321305945583828;0.0164699763337216                      </td><td>-h+h                                                                          </td></tr>
	<tr><th scope=row>8522</th><td>243.1602                                                                      </td><td>413.6365                                                                      </td><td>245.1750259                                                                   </td><td>411.627                                                                       </td><td>267.1564353;267.1566696;267.1594635;267.1596344;267.1592611                   </td><td>411.25585716;396.05650002;401.4705;427.96819998;417.55933332                  </td><td>                                                                              </td><td>                                                                              </td><td>C13H24O4;C6H24N6O2S                                                           </td><td>0.431298669214944;0.00611095714830009                                         </td><td>-h+h+na                                                                       </td></tr>
	<tr><th scope=row>8523</th><td>301.1655                                                                      </td><td>357.6255                                                                      </td><td>                                                                              </td><td>                                                                              </td><td>325.1638184                                                                   </td><td>353.0055                                                                      </td><td>                                                                              </td><td>                                                                              </td><td>C8H26N6O4S;C16H30OS2;C16H22N4O2                                               </td><td>0.00282137390954389;0.000549694561792814;2.23906843174615e-06                 </td><td>-h+na                                                                         </td></tr>
	<tr><th scope=row>8524</th><td>327.1817                                                                      </td><td>503.6720                                                                      </td><td>329.1936698;329.19369                                                         </td><td>491.09258622;520.9272222                                                      </td><td>351.1811638                                                                   </td><td>507.03349998                                                                  </td><td>                                                                              </td><td>                                                                              </td><td>C9H32N2O8S;C14H20N10                                                          </td><td>0.000627795519592861;2.36218323234734e-07                                     </td><td>-h+h                                                                          </td></tr>
	<tr><th scope=row>8527</th><td>299.1137                                                                      </td><td>302.1385                                                                      </td><td>301.125473                                                                    </td><td>308.77300002                                                                  </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>C11H12N10O                                                                    </td><td>2.29797451799277e-06                                                          </td><td>-h+h                                                                          </td></tr>
	<tr><th scope=row>8528</th><td>389.1605                                                                      </td><td>353.1760                                                                      </td><td>391.1756104;391.1757355                                                       </td><td>341.28379998;368.71699998                                                     </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>C21H26O7                                                                      </td><td>0.0636245566847554                                                            </td><td>-h+h                                                                          </td></tr>
	<tr><th scope=row>8529</th><td>255.1237                                                                      </td><td>278.5820                                                                      </td><td>257.1335144                                                                   </td><td>293.86000002                                                                  </td><td>279.1199493                                                                   </td><td>276.5865                                                                      </td><td>                                                                              </td><td>                                                                              </td><td>C13H20O5;C6H20N6O3S;C14H24S2                                                  </td><td>0.261342136146197;0.00161873960830912;0.000168614326355066                    </td><td>-h+na                                                                         </td></tr>
	<tr><th scope=row>8530</th><td>267.1603                                                                      </td><td>489.0155                                                                      </td><td>269.1749786;269.1747793                                                       </td><td>490.7748;469.03366668                                                         </td><td>291.1579208;291.1594353;291.1582825;291.1574707                               </td><td>469.86825;479.00824998;502.61860002;488.36119998                              </td><td>                                                                              </td><td>                                                                              </td><td>C15H24O4;C8H24N6O2S;C16H20N4                                                  </td><td>0.144251627065407;0.0222657612836073;2.03559220634049e-05                     </td><td>-h+h+na                                                                       </td></tr>
	<tr><th scope=row>8533</th><td>351.1812                                                                      </td><td>425.6760                                                                      </td><td>                                                                              </td><td>                                                                              </td><td>375.1785583;375.1806946;375.1801758                                           </td><td>420.66100002;411.99033336;426.29749998                                        </td><td>                                                                              </td><td>                                                                              </td><td>C19H28O6;C11H32N2O8S                                                          </td><td>0.100662887542405;0.0121832946543344                                          </td><td>-h+na                                                                         </td></tr>
	<tr><th scope=row>8534</th><td>325.1660                                                                      </td><td>418.6090                                                                      </td><td>327.1779709                                                                   </td><td>430.47100002                                                                  </td><td>349.1655477;349.1655762                                                       </td><td>429.68266668;414.86380002                                                     </td><td>                                                                              </td><td>                                                                              </td><td>C9H30N2O8S;C14H18N10                                                          </td><td>0.000937882049971275;4.20122662382886e-07                                     </td><td>-h+h                                                                          </td></tr>
	<tr><th scope=row>8539</th><td>269.1395                                                                      </td><td>365.2155                                                                      </td><td>271.1544266;271.1527023                                                       </td><td>363.20650002;380.48749998                                                     </td><td>293.1362061;293.1366272                                                       </td><td>367.97419998;347.59433334                                                     </td><td>                                                                              </td><td>                                                                              </td><td>C14H22O5;C7H22N6O3S;C15H26S2;C15H18N4O                                        </td><td>0.171903703424163;0.00941643940628411;0.00178865963132253;4.97809275511703e-06</td><td>-h+h+na                                                                       </td></tr>
	<tr><th scope=row>8540</th><td>341.1969                                                                      </td><td>447.9230                                                                      </td><td>                                                                              </td><td>                                                                              </td><td>365.1940842;365.1953583                                                       </td><td>467.106;449.84050002                                                          </td><td>307.2378387;307.2377243                                                       </td><td>464.77075002;432.0555                                                         </td><td>C18H30O6;C10H34N2O8S                                                          </td><td>0.0963520762374998;0.0146626498273976                                         </td><td>-h+na                                                                         </td></tr>
	<tr><th scope=row>8542</th><td>407.1708                                                                      </td><td>447.3995                                                                      </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>373.2044678                                                                   </td><td>449.85                                                                        </td><td>C9H28N10O4S;C17H32N4OS2                                                       </td><td>0.0630410286161741;0.0379612013116934                                         </td><td>+cl+cl                                                                        </td></tr>
	<tr><th scope=row>8545</th><td>345.1708                                                                      </td><td>457.0835                                                                      </td><td>347.1862061;347.1862418                                                       </td><td>445.12000002;465.59227272                                                     </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>                                                                              </td><td>C20H26O5;C13H26N6O3S;C12H30N2O7S                                              </td><td>0.0940822389831023;0.00918900572169441;0.00685909952675112                    </td><td>-h+h                                                                          </td></tr>
	<tr><th scope=row>8546</th><td>379.1761                                                                      </td><td>498.9605                                                                      </td><td>381.1889877                                                                   </td><td>489.35350002                                                                  </td><td>403.1733958                                                                   </td><td>487.53166668                                                                  </td><td>345.2042618                                                                   </td><td>504.421125                                                                    </td><td>C20H28O7;C12H32N2O9S                                                          </td><td>0.0748164977646689;0.0120077818110771                                         </td><td>-h+h+na                                                                       </td></tr>
</tbody>
</table>




```R
# split the first ranking formula in its atoms
lf1 <- sapply(allnegs[,"Formulas"], function(x) strsplit(x, ";")[[1]][1])

dfl <- lapply(lapply(lf1[!is.na(lf1)], split.fm), get.df)
log <- lapply(1:length(dfl), function(x) dfl[[x]]$id <<- x)
df1 <- dfl[[1]]
for(i in 2:length(dfl)) {
        df1 <- merge(x = df1, y = dfl[[i]],  all = TRUE)
}

df1 <- df1[order(df1$id), c("id", "C", "H", "O", "N", "S")]
df1[is.na(df1)] <- 0
fms5ppmNoP <- data.frame(allnegs[!is.na(lf1),1:2 ], lf1[!is.na(lf1)], df1)
colnames(fms5ppmNoP)[3] <- "FirstRankForm"

```


```R
head(fms5ppmNoP)
```


<table>
<thead><tr><th></th><th scope=col>row.m.z</th><th scope=col>row.retention.time</th><th scope=col>FirstRankForm</th><th scope=col>id</th><th scope=col>C</th><th scope=col>H</th><th scope=col>O</th><th scope=col>N</th><th scope=col>S</th></tr></thead>
<tbody>
	<tr><th scope=row>3</th><td>265.1478 </td><td>604.9176 </td><td>C12H26O4S</td><td>1        </td><td>12       </td><td>26       </td><td>4        </td><td>0        </td><td>1        </td></tr>
	<tr><th scope=row>4</th><td>331.2491 </td><td>535.4694 </td><td>C18H36O5 </td><td>2        </td><td>18       </td><td>36       </td><td>5        </td><td>0        </td><td>0        </td></tr>
	<tr><th scope=row>8</th><td>221.1546 </td><td>617.2219 </td><td>C14H22O2 </td><td>3        </td><td>14       </td><td>22       </td><td>2        </td><td>0        </td><td>0        </td></tr>
	<tr><th scope=row>10</th><td>233.1546 </td><td>618.5047 </td><td>C15H22O2 </td><td>4        </td><td>15       </td><td>22       </td><td>2        </td><td>0        </td><td>0        </td></tr>
	<tr><th scope=row>12</th><td>242.1762 </td><td>445.2437 </td><td>C13H25NO3</td><td>5        </td><td>13       </td><td>25       </td><td>3        </td><td>1        </td><td>0        </td></tr>
	<tr><th scope=row>13</th><td>309.1742 </td><td>638.6725 </td><td>C17H26N2O</td><td>6        </td><td>17       </td><td>26       </td><td>1        </td><td>2        </td><td>0        </td></tr>
</tbody>
</table>




```R
write.table(fms3ppmNoP, "fms3ppmNoP.tsv", row.names=FALSE, sep="\t")
```

## Come here only for neg


```R
# Load data and set variables
library(Rdisop)
source("code/matchIonizationMode.R")
source("code/get_form.R")
source("code/split_and_filter.R")
h <- 1.007276
cl <- 34.969402

# In case you want to calculate sum formulas with ions that do not match to positive
# If you have only negative mode data you can simple do:
negx <- neg

#negx <- neg[!((as.character(neg[,1]) %in% as.character(allnegs[,1])) & (as.character(neg[,2]) %in% as.character(allnegs[,2]))),]
```


```R
# replace old method
get.df <- function(fml, idx) as.data.frame(matrix(c(idx, fml[[2]]), dimnames=list(1, c("idx", fml[[1]])), nrow=1))
```


```R
# Notice that we are only doing [M-H] and using the h variable declared in the
# beginning of the code
f5ppmHnoP <- c("", "")
lf5ppmHnoP <- list()
for(i in 1:nrow(negx)) {
        tmp <- get_form(negx[i,1]+h, ppm=5, elements = initializeElements(c("C","H", "N", "O", "S")))
        if(nrow(tmp)>0) {
                if(nrow(tmp)>10) {
                        tmp <- tmp[1:10,]
                }
                idx <- sapply(tmp[,1], function(x) filter.rules(split.fm(x)))
                f5ppmHnoP <- rbind(f5ppmHnoP, c(paste(tmp[idx,1], collapse=","),  paste(tmp[idx,2], collapse=",")))
                if(sum(idx)) {
                        lf5ppmHnoP[[i]] <- get.df(split.fm(tmp[idx,1][1]), i)
                }
        } else {
                f5ppmHnoP <- rbind(f5ppmHnoP, c("", ""))
        }       
             
}       

```


```R
negx <-cbind(negx[,1:2], f5ppmHnoP[-1,])
colnames(negx)[3:4] <- c("Formulas","Scores")
head(negx)
```


<table>
<thead><tr><th scope=col>row.m.z</th><th scope=col>row.retention.time</th><th scope=col>Formulas</th><th scope=col>Scores</th></tr></thead>
<tbody>
	<tr><td>355.1581                                                                    </td><td>686.2329                                                                    </td><td>C10H24N6O8,C10H32N2O7S2,C18H28O5S                                           </td><td>0.089699770643745,0.0524623294097015,0.0503164497053307                     </td></tr>
	<tr><td>194.0821                                                                    </td><td>583.3693                                                                    </td><td>C10H13NO3                                                                   </td><td>0.786343249167303                                                           </td></tr>
	<tr><td>265.1478                                                                    </td><td>604.9176                                                                    </td><td>C12H26O4S,C5H18N10O3                                                        </td><td>0.291728046899418,8.32079874865639e-06                                      </td></tr>
	<tr><td>331.2491                                                                    </td><td>535.4694                                                                    </td><td>C18H36O5,C11H36N6O3S,C10H40N2O7S,C19H40S2                                   </td><td>0.103916652331871,0.0151462362298204,0.00492264716599492,0.00490877721265675</td></tr>
	<tr><td>250.1448                                                                    </td><td>637.5046                                                                    </td><td>C14H21NO3,C7H21N7OS                                                         </td><td>0.289636695142152,0.0025814842328478                                        </td></tr>
	<tr><td>293.1792                                                                    </td><td>677.7425                                                                    </td><td>C14H30O4S,C7H22N10O3,C15H26N4S                                              </td><td>0.191817160686449,0.000161707513069561,1.74226007868597e-05                 </td></tr>
</tbody>
</table>




```R
# Again, split formulas and format atom table
dfl <- lf5ppmHnoP
df1 <- data.frame()
for(i in 1:length(dfl)) {
        if(!is.null(dfl[[i]])) {
                if(length(df1)==0) {
                        df1 <- dfl[[i]]
                } else {
                        df1 <- merge(x = df1, y = dfl[[i]],  all = TRUE)
                }
        }
}

df1 <- df1[order(df1$id), c("idx", "C", "H", "O", "N", "S")]
df1[is.na(df1)] <- 0
fms5ppmHnoP <- data.frame(negx[df1$idx,1:2 ],  df1)
```


```R
head(fms5ppmHnoP)
```


<table>
<thead><tr><th scope=col>row.m.z</th><th scope=col>row.retention.time</th><th scope=col>idx</th><th scope=col>C</th><th scope=col>H</th><th scope=col>O</th><th scope=col>N</th><th scope=col>S</th></tr></thead>
<tbody>
	<tr><td>355.1581</td><td>686.2329</td><td>1       </td><td>10      </td><td>24      </td><td>8       </td><td>6       </td><td>0       </td></tr>
	<tr><td>194.0821</td><td>583.3693</td><td>2       </td><td>10      </td><td>13      </td><td>3       </td><td>1       </td><td>0       </td></tr>
	<tr><td>265.1478</td><td>604.9176</td><td>3       </td><td>12      </td><td>26      </td><td>4       </td><td>0       </td><td>1       </td></tr>
	<tr><td>331.2491</td><td>535.4694</td><td>4       </td><td>18      </td><td>36      </td><td>5       </td><td>0       </td><td>0       </td></tr>
	<tr><td>250.1448</td><td>637.5046</td><td>5       </td><td>14      </td><td>21      </td><td>3       </td><td>1       </td><td>0       </td></tr>
	<tr><td>293.1792</td><td>677.7425</td><td>6       </td><td>14      </td><td>30      </td><td>4       </td><td>0       </td><td>1       </td></tr>
</tbody>
</table>




```R
# Output table
write.table(negx, "DOM_Neg_all_filtered.tsv", row.names=FALSE, sep="\t")
write.table(fms5ppmHnoP, "DOM_Neg_Top1_atom.tsv", row.names=FALSE, sep="\t")
```

## For Pos only start here



```R
# Load data and set variables
library(Rdisop)
source("code/matchIonizationMode.R")
source("code/get_form.R")
source("code/split_and_filter.R")
h <- 1.007276
na <- 22.989218

# In case you want to calculate sum formulas with ions that do not match to negative
# If you have only positive mode data you can simple do:
posx <- pos

#posx <- pos[!((as.character(pos[,1]) %in% as.character(mzs2)) & (as.character(pos[,2]) %in% as.character(rts2))),]
```


```R
# replace old method
get.df <- function(fml, idx) as.data.frame(matrix(c(idx, fml[[2]]), dimnames=list(1, c("idx", fml[[1]])), nrow=1))
```


```R
# Notice that we are only doing [M+H] and using the h variable declared in the
# beginning of the code
f5ppmHnoP <- c("", "")
lf5ppmHnoP <- list()

for(i in 1:nrow(posx)) {
        tmp <- get_form(posx[i,1]-h, ppm=1, elements = initializeElements(c("C","H", "N", "O", "S")))
        if(!is.null(tmp)) {
                if(nrow(tmp)!=0) {
                        if(nrow(tmp)>10) {
                                tmp <- tmp[1:10,]
                        }
                        idx <- sapply(tmp[,1], function(x) filter.rules(split.fm(x)))
                        f5ppmHnoP <- rbind(f5ppmHnoP, c(paste(tmp[idx,1], collapse=","),  paste(tmp[idx,2], collapse=",")))
                        if(sum(idx)) {
                                lf5ppmHnoP[[i]] <- get.df(split.fm(tmp[idx,1][1]), i)
                        }
                } else {
                        f5ppmHnoP <- rbind(f5ppmHnoP, c("", ""))
                }
        } else {
                f5ppmHnoP <- rbind(f5ppmHnoP, c("", ""))
        }
}
```


```R
head(posx)
```


<table>
<thead><tr><th scope=col>row.m.z</th><th scope=col>row.retention.time</th></tr></thead>
<tbody>
	<tr><td> 531.4083</td><td>671.3660 </td></tr>
	<tr><td> 553.3899</td><td>670.8391 </td></tr>
	<tr><td>1083.7911</td><td>671.3786 </td></tr>
	<tr><td>1061.8108</td><td>671.4954 </td></tr>
	<tr><td> 242.2845</td><td>606.0859 </td></tr>
	<tr><td> 437.1940</td><td>579.7484 </td></tr>
</tbody>
</table>




```R
posx <-cbind(posx[,1:2], f5ppmHnoP[-1,])
colnames(posx)[3:4] <- c("Formulas","Scores")
head(posx)
```


<table>
<thead><tr><th scope=col>MZ</th><th scope=col>RT</th><th scope=col>Formulas</th><th scope=col>Scores</th></tr></thead>
<tbody>
	<tr><td>216.1492                                                </td><td>282.2794                                                </td><td>                                                        </td><td>                                                        </td></tr>
	<tr><td>547.2610                                                </td><td>394.5784                                                </td><td>C23H38N4O11                                             </td><td>0.0191323102196837                                      </td></tr>
	<tr><td>216.6508                                                </td><td>275.2440                                                </td><td>                                                        </td><td>                                                        </td></tr>
	<tr><td>427.2905                                                </td><td>330.7627                                                </td><td>C13H42N6O7S,C20H42O9                                    </td><td>0.0328314700945723,0.0293306677077991                   </td></tr>
	<tr><td>369.2487                                                </td><td>291.1573                                                </td><td>C10H36N6O6S,C18H40O3S2,C17H36O8                         </td><td>0.0586710834058779,0.0310027944483811,0.0302073361746901</td></tr>
	<tr><td>361.2225                                                </td><td>630.3100                                                </td><td>C11H32N6O5S,C19H36O2S2,C18H32O7                         </td><td>0.0769280539944436,0.0411850018224801,0.0295789226161476</td></tr>
</tbody>
</table>




```R
# Again, split formulas and format atom table
dfl <- lf5ppmHnoP
df1 <- data.frame()
for(i in 1:length(dfl)) {
        if(!is.null(dfl[[i]])) {
                if(length(df1)==0) {
                        df1 <- dfl[[i]]
                } else {
                        df1 <- merge(x = df1, y = dfl[[i]],  all = TRUE)
                }
        }
}

df1 <- df1[order(df1$id), c("idx", "C", "H", "O", "N", "S")]
df1[is.na(df1)] <- 0
fms5ppmHnoP <- data.frame(posx[df1$idx,1:2 ],  df1)
```


```R
head(fms5ppmHnoP)
```


<table>
<thead><tr><th></th><th scope=col>MZ</th><th scope=col>RT</th><th scope=col>idx</th><th scope=col>C</th><th scope=col>H</th><th scope=col>O</th><th scope=col>N</th><th scope=col>S</th></tr></thead>
<tbody>
	<tr><th scope=row>2</th><td>547.2610</td><td>394.5784</td><td> 2      </td><td>23      </td><td>38      </td><td>11      </td><td>4       </td><td>0       </td></tr>
	<tr><th scope=row>4</th><td>427.2905</td><td>330.7627</td><td> 4      </td><td>13      </td><td>42      </td><td> 7      </td><td>6       </td><td>1       </td></tr>
	<tr><th scope=row>5</th><td>369.2487</td><td>291.1573</td><td> 5      </td><td>10      </td><td>36      </td><td> 6      </td><td>6       </td><td>1       </td></tr>
	<tr><th scope=row>6</th><td>361.2225</td><td>630.3100</td><td> 6      </td><td>11      </td><td>32      </td><td> 5      </td><td>6       </td><td>1       </td></tr>
	<tr><th scope=row>8</th><td>267.1801</td><td>218.7413</td><td> 8      </td><td>12      </td><td>26      </td><td> 6      </td><td>0       </td><td>0       </td></tr>
	<tr><th scope=row>10</th><td>627.2851</td><td>448.8458</td><td>10      </td><td>19      </td><td>50      </td><td>18      </td><td>2       </td><td>1       </td></tr>
</tbody>
</table>




```R
# Output table
write.table(posx, "DOM_Pos_all.tsv", row.names=FALSE, sep="\t")
write.table(fms5ppmHnoP, "DOM_Pos_Top-1_atom.tsv", row.names=FALSE, sep="\t")
```


```R

```
